From a5f147945321faa36438f18d9ed9a23855b21841 Mon Sep 17 00:00:00 2001
From: Matthieu Crapet <mcrapet@gmail.com>
Date: Sat, 7 Feb 2009 13:38:02 +0100
Subject: [PATCH 07/20] ep93xx_gpio_leds

---
 arch/arm/mach-ep93xx/core.c |   31 +++++++++++++++++++++++++++++++
 1 files changed, 31 insertions(+), 0 deletions(-)

diff --git a/arch/arm/mach-ep93xx/core.c b/arch/arm/mach-ep93xx/core.c
index 0460d21..a62ab21 100644
--- a/arch/arm/mach-ep93xx/core.c
+++ b/arch/arm/mach-ep93xx/core.c
@@ -34,6 +34,7 @@
 #include <linux/amba/bus.h>
 #include <linux/amba/serial.h>
 #include <linux/io.h>
+#include <linux/leds.h>
 
 #include <asm/types.h>
 #include <asm/setup.h>
@@ -515,6 +516,35 @@ void __init ep93xx_register_eth(struct ep93xx_eth_data *data, int copy_addr)
 	platform_device_register(&ep93xx_eth_device);
 }
 
+
+static const struct gpio_led ep93xx_led_pins[] = {
+  {
+    .name = "green",
+    .gpio = EP93XX_GPIO_LINE_GRLED,
+    .active_low = 0,
+    .default_trigger = "heartbeat",
+  },
+  {
+    .name = "red",
+    .gpio = EP93XX_GPIO_LINE_RDLED,
+    .active_low = 0,
+  }
+};
+
+static const struct gpio_led_platform_data ep93xx_led_data = {
+  .num_leds = ARRAY_SIZE(ep93xx_led_pins),
+  .leds = (void *)ep93xx_led_pins,
+};
+
+static struct platform_device ep93xx_gpio_leds = {
+  .name = "leds-gpio",
+  .id = -1,
+  .dev = {
+    .platform_data = (void *)&ep93xx_led_data,
+  }
+};
+
+
 extern void ep93xx_gpio_init(void);
 
 void __init ep93xx_init_devices(void)
@@ -535,6 +565,7 @@ void __init ep93xx_init_devices(void)
 	amba_device_register(&uart2_device, &iomem_resource);
 	amba_device_register(&uart3_device, &iomem_resource);
 
+	platform_device_register(&ep93xx_gpio_leds);
 	platform_device_register(&ep93xx_rtc_device);
 	platform_device_register(&ep93xx_ohci_device);
 }
-- 
1.5.6.5

